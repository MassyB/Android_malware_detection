# module qui va contenir le code "métier" relatif à la bdd

from db_context_managers import OpenReaderCursor, OpenWriterCursor

_SQL_get_api_permissions = """ SELECT permission
                                   FROM api_permission_mapping
                                   WHERE api = :api """

_SQL_is_suspicious_methode_description = """ SELECT count(api)
                                             FROM suspicious_apis
                                             WHERE api = :api"""


def get_api_permissions(api: str) -> list:
    with OpenReaderCursor(_SQL_get_api_permissions, {'api': api}) as cursor:
        return [permission[0] for permission in cursor.fetchall()]


def is_suspicious(method_description: str) -> bool:
    with OpenReaderCursor(_SQL_is_suspicious_methode_description, {'api': method_description}) as cursor:
        return cursor.fetchone()[0] != 0


