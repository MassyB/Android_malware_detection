from db_context_managers import OpenReaderCursor

_SQL_get_dimensions = """SELECT printf("%s::%s", type, name) AS dimension
                         FROM dimensions"""

_SQL_get_top_dimensions = """SELECT printf("%s::%s", type, name) AS dimension
                             FROM dimensions
                             WHERE malware_usage >= :malware_usage
                                   AND
	                               malware_ratio >= :malware_ratio"""


def get_all_dimensions() -> list:
    """returns all the dimensions of the apks in the DB"""
    with OpenReaderCursor(_SQL_get_dimensions) as cursor:
        return [dimension[0] for dimension in cursor.fetchall()]


def get_top_dimensions(malware_usage=0, malware_ratio=0) -> list:
    """returns all the dimensions that have dimension.malware_usage > malware_usage
       and dimension.malware_ratio > malware_ratio """
    with OpenReaderCursor(_SQL_get_top_dimensions, {'malware_usage': malware_usage,
                                                    'malware_ratio': malware_ratio}) as curosr:
        return [dimension[0] for dimension in curosr.fetchall()]
