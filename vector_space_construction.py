from db_context_managers import OpenReaderCursor
from vector_space_construction_SQL import _SQL_get_dimensions
from db_manager import get_apk_features
from apk import APK


def get_vector_space_dimensions() -> list:
    with OpenReaderCursor(_SQL_get_dimensions) as cursor:
        return [dimension[0] for dimension in cursor.fetchall()]


def get_vector_space_dict() -> dict:
    dimensions = get_vector_space_dimensions()
    indices = range(len(dimensions))
    return {dimension: indice for dimension, indice in zip(dimensions, indices)}


def get_app_sparse_feature_vector(vector_space_dict: dict, apk: 'APK') -> list:
    """getting the apk_features from the DB and then returning the indices of the features in the VS"""
    apk_features = get_apk_features(apk.get_name())
    return [vector_space_dict[feature] for feature in apk_features]

